(function(){var a={dataPath:"data/",dataBest:"best.dat",dataSolutions:"solution.%n.dat",answer:[],renderedLines:0,toLines:0,rendering:!1,$tchislaPad:document.getElementById("tchislaPad"),$solutions:document.getElementById("solutions"),$answer:document.getElementById("answer"),$last:document.getElementById("last"),$next:document.getElementById("next"),$quiz:document.getElementById("quiz"),$formula:document.getElementById("formula"),$solution:document.getElementById("solution"),getName:function(b){return a.dataSolutions.replace(/%n/,(b-1)/50|0)},getLatex:function(a,d){return"$$"+a+"="+d.replace(/([a-z])/g,"#$1").replace(/#t/g,"\\times").replace(/#s/g,"\\sqrt").replace(/#l/g,"\\left").replace(/#r/g,"\\right").replace(/#f/g,"\\frac").replace(/#x/g,"\\textstyle")+"$$"}},c=window.tchisla={getData:function(b,d,c){var e=new XMLHttpRequest;e.open("GET",a.dataPath+b,c);e.onload=function(){200<=e.status&&400>e.status&&(console.log("file load success",b),a[b]=e.responseText,d(a[b]))};e.send()},parseData:function(b){b.split(/[\n\r]+/).forEach(function(b){b.match(/^\d+,\d+,[^,]+,[^,]+$/)&&(b=b.split(","),a.answer[b[0]]=a.answer[b[0]]||[],a.answer[b[0]][b[1]]=[b[2],b[3]])})},onScroll:function(){var b=window.scrollY/41+51|0;a.renderedLines<b&&(a.toLines=b,a.rendering||c.renderPad())},renderPad:function(){a.rendering=!0;a.maxY<a.toLines&&(a.toLines=a.maxY);for(;a.renderedLines<a.toLines;){var b=++a.renderedLines,d=document.createElement("tr"),c=document.createElement("td");c.setAttribute("class","row");c.innerText=b;d.appendChild(c);for(var e=1;9>=e;e++)c=document.createElement("td"),c.setAttribute("rel",b+"#"+e),c.innerText=parseInt(a.bestArr[b-1][e-1],36),d.appendChild(c);a.$solutions.appendChild(d)}a.rendering=!1},showAnswer:function(b,c){a.x=+c;a.y=+b;a.$answer.style.display="block";a.$quiz.innerText=b+"#"+c;a.$solution.innerText=b+"="+a.answer[b][c][0];MathJax&&(a.$formula.innerText=a.getLatex(b,a.answer[b][c][1]),MathJax.Hub.Queue(["Typeset",MathJax.Hub,a.$formula]))},render:function(){c.getData(a.dataBest,function(b){a.bestArr=a[a.dataBest].split(/[\n\r]+/);a.maxY=a.bestArr.length;a.$tchislaPad.style.height=41*a.bestArr.length+6+"px";a.toLines=50;a.rendering||c.renderPad()},!0);a.$solutions.addEventListener("click",function(b){if(b=b.target.getAttribute("rel")){var d=b.split("#");b=+d[0];d=+d[1];a[a.getName(b)]||c.getData(a.getName(b),c.parseData,!1);c.showAnswer(b,d)}});a.$answer.addEventListener("click",function(b){"last"===b.target.id?(0===--a.x&&(a.x=9,a.y--),0>=a.y&&(a.x=1,a.y=1),c.showAnswer(a.y,a.x)):"next"===b.target.id?(10===++a.x&&(a.x=1,a.y++),a.y>a.maxY&&(a.x=9,a.y=a.maxY),c.showAnswer(a.y,a.x)):a.$answer.style.display="none"});document.addEventListener("scroll",c.onScroll)}};c.render();window.sys=a})();
